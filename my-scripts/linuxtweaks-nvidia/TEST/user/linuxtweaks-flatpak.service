#  systemctl --user daemon-reexec && systemctl --user daemon-reload && systemctl --user enable --now linuxtweaks-flatpak.{service,timer}
[Unit]
Description=LinuxTweaks Flatpak Automatic Update and Notification VER: 5.0
After=network-online.target
ConditionACPower=true
Documentation=man:flatpak(1)
Wants=network-online.target

[Service]
Type=oneshot
Environment="DISPLAY=:0"
Environment="DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus"
ExecCondition=/bin/bash -c '[[ "$(busctl get-property org.freedesktop.NetworkManager /org/freedesktop/NetworkManager org.freedesktop.NetworkManager Metered | cut -d\" \" -f3)" =~ ^(2|4)$ ]] && exit 1 || exit 0'
ExecStartPre=/bin/bash -c 'for i in {1..10}; do busctl --user call org.freedesktop.Notifications /org/freedesktop/Notifications org.freedesktop.DBus.Peer Ping; [ $? -eq 0 ] && exit 0; sleep 1; done; exit 1'
ExecStart=/bin/bash -c '/usr/bin/notify-send "" "ğŸŒ â˜€ï¸ Checking for flatpak cruft" --app-name="ğŸ”§  Flatpak Maintenance" -i /usr/local/bin/LinuxTweaks/images/LinuxTweak.png -u NORMAL && /usr/bin/flatpak --system uninstall --unused -y --noninteractive && /usr/bin/flatpak --user uninstall --unused -y --noninteractive && sleep 5 && /usr/bin/notify-send "" "ğŸ“¡  Checking for flatpak UPDATES" --app-name="ğŸ“¡  Flatpak Updater" -i /usr/local/bin/LinuxTweaks/images/LinuxTweak.png -u NORMAL && /usr/bin/flatpak --system update -y --noninteractive && /usr/bin/flatpak --user update -y --noninteractive && sleep 5 && /usr/bin/notify-send "" "ğŸ’»  Checking and repairing Flatpaks" --app-name="ğŸ”§  Flatpak Repair Service" -i /usr/local/bin/LinuxTweaks/images/LinuxTweak.png -u NORMAL && /usr/bin/flatpak --system repair && /usr/bin/flatpak --user repair && sleep 5 && /usr/bin/notify-send "Flatpaks checked, fixed and updated" "âœ…  Your computer is ready!" --app-name="ğŸ’»  Flatpak Update Service" -i /usr/local/bin/LinuxTweaks/images/LinuxTweak.png -u NORMAL'

Environment=SYSTEMD_SLEEP_FREEZE_USER_SESSIONS=0
TimeoutStopFailureMode=abort

[Install]
WantedBy=default.target
